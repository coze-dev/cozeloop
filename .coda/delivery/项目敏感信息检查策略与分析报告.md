# é¡¹ç›®æ•æ„Ÿä¿¡æ¯æ£€æŸ¥ç­–ç•¥ä¸åˆ†ææŠ¥å‘Š

## 1. é¡¹ç›®æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªåä¸º CozeLoop çš„å…¨æ ˆé¡¹ç›®ï¼ŒåŒ…å«ï¼š
- **åç«¯**ï¼šGo è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨ Hertz å’Œ Kitex æ¡†æ¶
- **å‰ç«¯**ï¼šTypeScript/React åº”ç”¨
- **é…ç½®**ï¼šå¤šç§ç¯å¢ƒé…ç½®æ–‡ä»¶
- **å®¹å™¨åŒ–**ï¼šDocker å’Œ docker-compose éƒ¨ç½²

## 2. æ•æ„Ÿä¿¡æ¯æ£€æŸ¥ç­–ç•¥

### 2.1 é‡ç‚¹æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œç›®å½•

#### é«˜ä¼˜å…ˆçº§ç›®å½•
1. **conf/** - é…ç½®æ–‡ä»¶ç›®å½•
   - `conf/default/mysql/.cnf` - MySQL é…ç½®
   - `conf/default/redis/.cnf` - Redis é…ç½®  
   - `conf/default/clickhouse/.cnf` - ClickHouse é…ç½®
   - `conf/default/minio/.cnf` - MinIO é…ç½®

2. **backend/modules/llm/** - LLM æ¨¡å—ï¼ˆæ¨¡å‹ API é…ç½®ï¼‰
   - `backend/modules/llm/infra/config/` - æ¨¡å‹é…ç½®ç®¡ç†
   - `backend/modules/llm/domain/entity/config.go` - è¿è¡Œæ—¶é…ç½®å®ä½“

3. **backend/pkg/conf/** - é…ç½®ç®¡ç†åŒ…

#### ä¸­ä¼˜å…ˆçº§ç›®å½•
4. **backend/** - åç«¯æºç 
5. **frontend/** - å‰ç«¯æºç 
6. **docker-compose.yml** - å®¹å™¨ç¼–æ’é…ç½®
7. **Dockerfile** - å®¹å™¨æ„å»ºé…ç½®

### 2.2 éœ€è¦æœç´¢çš„æ•æ„Ÿä¿¡æ¯å…³é”®è¯

#### æ¨¡å‹ API ç›¸å…³
- `api_key`ã€`apikey`ã€`api-key`
- `secret_key`ã€`secret`
- `access_key`ã€`access_token`
- `qianfan_ak`ã€`qianfan_sk` (åƒå¸†å¹³å°)
- `session_token`
- `secret_access_key`

#### æ•°æ®åº“å’ŒæœåŠ¡è®¤è¯
- `password`ã€`pwd`
- `token`
- `credential`ã€`credentials`
- `auth`ã€`authorization`

#### ç¯å¢ƒå˜é‡å’Œé…ç½®
- `env`ã€`environment`
- `config`ã€`configuration`
- `key`ã€`keys`

### 2.3 æ£€æŸ¥æ–¹æ³•å’Œä¼˜å…ˆçº§

#### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šé…ç½®æ–‡ä»¶ç›´æ¥æ£€æŸ¥
1. æ‰‹åŠ¨æ£€æŸ¥ `.cnf` æ–‡ä»¶
2. æœç´¢ YAML/JSON é…ç½®æ–‡ä»¶
3. æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶

#### ç¬¬äºŒä¼˜å…ˆçº§ï¼šä»£ç æ–‡ä»¶æœç´¢
1. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æºç 
2. æ£€æŸ¥ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
3. åˆ†æé…ç½®åŠ è½½é€»è¾‘

## 3. å·²å‘ç°çš„æ•æ„Ÿä¿¡æ¯

### 3.1 æ•°æ®åº“é…ç½®ï¼ˆå·²å‘ç°ï¼‰

#### MySQL é…ç½® (`conf/default/mysql/.cnf`)
```
USER=root
PASSWORD=cozeloop-mysql
DATABASE=cozeloop-mysql
```

#### Redis é…ç½® (`conf/default/redis/.cnf`)
```
PASSWORD=cozeloop-redis
```

#### ClickHouse é…ç½® (`conf/default/clickhouse/.cnf`)
```
USER=default
PASSWORD=cozeloop-clickhouse
DATABASE=cozeloop-clickhouse
```

#### MinIO é…ç½® (`conf/default/minio/.cnf`)
```
USER=root
PASSWORD=cozeloop-minio
BUCKET=cozeloop-minio
```

### 3.2 æ¨¡å‹ API é…ç½®ï¼ˆå·²å‘ç°å®é™…é…ç½®æ–‡ä»¶ï¼‰

#### å®é™…æ¨¡å‹é…ç½®æ–‡ä»¶ (`conf/default/app/runtime/model_config.yaml`)
```yaml
models:
  - id: 1
    name: "doubao"
    protocol: "ark"
    protocol_config:
      api_key: "***"  # è±†åŒ…æ¨¡å‹ API Key (å·²è„±æ•)
      model: "***"    # æ¨¡å‹åç§° (å·²è„±æ•)
  - id: 2
    name: "openapi"
    protocol: "openai"
    protocol_config:
      api_key: "***"  # OpenAI API Key (å·²è„±æ•)
      model: "***"    # æ¨¡å‹åç§° (å·²è„±æ•)
```

#### è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ (`conf/default/app/runtime/model_runtime_config.yaml`)
```yaml
need_cvt_url_to_base_64: true
qianfan_ak: "***"  # åƒå¸† AccessKey (å·²è„±æ•)
qianfan_sk: "***"  # åƒå¸† SecretKey (å·²è„±æ•)
```

#### åŸºç¡€è®¾æ–½é…ç½®æ–‡ä»¶ (`conf/default/app/runtime/infrastructure.yaml`)
```yaml
infra:
  redis:
    password: "cozeloop-redis"
  rds:
    password: "cozeloop-mysql"
  s3_config:
    access_key: 'root'
    secret_access_key: 'cozeloop-minio'
  ck_config:
    password: "cozeloop-clickhouse"
```

### 3.3 ä»£ç ä¸­çš„æ•æ„Ÿä¿¡æ¯é…ç½®ç»“æ„

#### ä¸»ç¨‹åºé…ç½®ç»“æ„ (`backend/cmd/main.go`)
```go
type ComponentConfig struct {
    Redis struct {
        Password string `mapstructure:"password"`
    } `mapstructure:"redis"`
    RDS struct {
        Password string `mapstructure:"password"`
    } `mapstructure:"rds"`
    S3Config struct {
        AccessKey       string `mapstructure:"access_key"`
        SecretAccessKey string `mapstructure:"secret_access_key"`
    } `mapstructure:"s3_config"`
    CKConfig struct {
        Password string `mapstructure:"password"`
    } `mapstructure:"ck_config"`
}
```

#### LLMè¿è¡Œæ—¶é…ç½®å®ä½“ (`backend/modules/llm/domain/entity/config.go`)
```go
type RuntimeConfig struct {
    QianfanAk string `json:"qianfan_ak"`  // åƒå¸† AccessKey
    QianfanSk string `json:"qianfan_sk"`  // åƒå¸† SecretKey
}
```

#### æ¨¡å‹é…ç½®æ¨¡æ¿æ–‡ä»¶
å‘ç°å¤šä¸ªæ¨¡å‹é…ç½®æ¨¡æ¿æ–‡ä»¶ï¼ŒåŒ…å« API Key é…ç½®å­—æ®µï¼š
- `backend/modules/llm/infra/config/model_repo_example/openai.yaml`
- `backend/modules/llm/infra/config/model_repo_example/claude.yaml`
- `backend/modules/llm/infra/config/model_repo_example/qianfan.yaml`
- ç­‰å…¶ä»–æ¨¡å‹é…ç½®æ¨¡æ¿

### 3.4 å‘ç°çš„æ‰€æœ‰æ•æ„Ÿä¿¡æ¯æ–‡ä»¶æ¸…å•

#### é«˜é£é™©æ–‡ä»¶ï¼ˆåŒ…å«å®é™…æ•æ„Ÿä¿¡æ¯ï¼‰
1. `conf/default/mysql/.cnf` - MySQLæ•°æ®åº“å¯†ç 
2. `conf/default/redis/.cnf` - Rediså¯†ç 
3. `conf/default/clickhouse/.cnf` - ClickHouseæ•°æ®åº“å¯†ç 
4. `conf/default/minio/.cnf` - MinIOå¯¹è±¡å­˜å‚¨å¯†ç 
5. `conf/default/app/runtime/model_config.yaml` - æ¨¡å‹APIå¯†é’¥ï¼ˆå·²è„±æ•ï¼‰
6. `conf/default/app/runtime/model_runtime_config.yaml` - åƒå¸†æ¨¡å‹å¯†é’¥ï¼ˆå·²è„±æ•ï¼‰
7. `conf/default/app/runtime/infrastructure.yaml` - åŸºç¡€è®¾æ–½é…ç½®å¯†ç 

#### ä¸­é£é™©æ–‡ä»¶ï¼ˆé…ç½®ç»“æ„å’Œæ¨¡æ¿ï¼‰
8. `backend/cmd/main.go` - æ•æ„Ÿä¿¡æ¯é…ç½®ç»“æ„å®šä¹‰
9. `backend/modules/llm/domain/entity/config.go` - LLMé…ç½®ç»“æ„
10. `backend/modules/llm/infra/config/model_repo_example/*.yaml` - æ¨¡å‹é…ç½®æ¨¡æ¿

#### è„šæœ¬æ–‡ä»¶ï¼ˆå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯å¤„ç†é€»è¾‘ï¼‰
11. `conf/default/mysql/entrypoint.sh` - MySQLå¯åŠ¨è„šæœ¬ï¼Œè¯»å–å¯†ç é…ç½®
12. `conf/default/redis/entrypoint.sh` - Rediså¯åŠ¨è„šæœ¬
13. `conf/default/minio/entrypoint.sh` - MinIOå¯åŠ¨è„šæœ¬ï¼Œå¤„ç†å¯†ç ç¯å¢ƒå˜é‡
14. `conf/default/clickhouse/entrypoint.sh` - ClickHouseå¯åŠ¨è„šæœ¬

## 4. é£é™©è¯„ä¼°

### 4.1 é«˜é£é™©é¡¹
1. **æ•°æ®åº“å¯†ç æ˜æ–‡å­˜å‚¨** - æ‰€æœ‰æ•°æ®åº“é…ç½®æ–‡ä»¶éƒ½åŒ…å«æ˜æ–‡å¯†ç 
2. **æ¨¡å‹ API å¯†é’¥é…ç½®æ–‡ä»¶å­˜åœ¨** - è™½ç„¶å·²è„±æ•æ˜¾ç¤ºä¸º"***"ï¼Œä½†å®é™…è¿è¡Œæ—¶éœ€è¦çœŸå®å¯†é’¥
3. **å¯¹è±¡å­˜å‚¨å¯†é’¥æ˜æ–‡å­˜å‚¨** - MinIOè®¿é—®å¯†é’¥å’Œç§˜é’¥æ˜æ–‡å­˜å‚¨
4. **é…ç½®æ–‡ä»¶è·¯å¾„æš´éœ²** - ä»£ç ä¸­ç¡¬ç¼–ç äº†é…ç½®æ–‡ä»¶è·¯å¾„
5. **è„šæœ¬æ–‡ä»¶å¤„ç†æ•æ„Ÿä¿¡æ¯** - å¯åŠ¨è„šæœ¬ç›´æ¥è¯»å–å’Œä½¿ç”¨å¯†ç é…ç½®

### 4.2 ä¸­é£é™©é¡¹
1. **é…ç½®æ¨¡æ¿æ–‡ä»¶** - è™½ç„¶æ˜¯ç¤ºä¾‹ï¼Œä½†åŒ…å«æ•æ„Ÿå­—æ®µç»“æ„ï¼Œå¯èƒ½è¢«è¯¯ç”¨
2. **Dockeré…ç½®** - é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’æ•æ„Ÿä¿¡æ¯
3. **ä»£ç ä¸­çš„é…ç½®ç»“æ„** - æ˜ç¡®å®šä¹‰äº†æ•æ„Ÿä¿¡æ¯çš„å­˜å‚¨ç»“æ„

### 4.3 å‘ç°çš„æ•æ„Ÿä¿¡æ¯ç±»å‹
1. **æ•°æ®åº“è®¤è¯ä¿¡æ¯**ï¼š
   - MySQL: `root/cozeloop-mysql`
   - Redis: `cozeloop-redis`
   - ClickHouse: `default/cozeloop-clickhouse`

2. **å¯¹è±¡å­˜å‚¨è®¤è¯ä¿¡æ¯**ï¼š
   - MinIO: `root/cozeloop-minio`

3. **æ¨¡å‹APIå¯†é’¥**ï¼š
   - è±†åŒ…(Ark)æ¨¡å‹ API Key
   - OpenAI API Key
   - åƒå¸†å¹³å° AccessKey/SecretKey

4. **æ¶ˆæ¯é˜Ÿåˆ—é…ç½®**ï¼š
   - RocketMQåœ°å€é…ç½®ï¼ˆè™½ç„¶æ— å¯†ç ï¼Œä½†æš´éœ²äº†å†…éƒ¨æ¶æ„ï¼‰

## 5. æ£€æŸ¥å»ºè®®

### 5.1 ç«‹å³æ£€æŸ¥çš„æ–‡ä»¶
1. æŸ¥æ‰¾å®é™…çš„æ¨¡å‹é…ç½®æ–‡ä»¶ï¼š
   - `model_config.yaml`
   - `model_runtime_config.yaml`
2. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `.env` æ–‡ä»¶
3. æœç´¢é¡¹ç›®ä¸­æ‰€æœ‰åŒ…å« "api_key" çš„æ–‡ä»¶

### 5.2 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬
```bash
# æœç´¢å¯èƒ½åŒ…å« API Key çš„æ–‡ä»¶
find . -type f \( -name "*.yaml" -o -name "*.yml" -o -name "*.json" -o -name "*.env*" -o -name "*.cnf" \) -exec grep -l "api_key\|secret\|token\|password" {} \;

# æœç´¢æºç ä¸­çš„ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
grep -r -i "api_key\|secret_key\|access_key" --include="*.go" --include="*.ts" --include="*.js" .
```

## 6. å®‰å…¨å»ºè®®

### 6.1 çŸ­æœŸæªæ–½
1. å°†æ‰€æœ‰æ•æ„Ÿé…ç½®ç§»è‡³ç¯å¢ƒå˜é‡
2. ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚ Vaultï¼‰
3. ç¡®ä¿ `.gitignore` åŒ…å«æ‰€æœ‰æ•æ„Ÿæ–‡ä»¶

### 6.2 é•¿æœŸæªæ–½
1. å®æ–½å¯†é’¥è½®æ¢æœºåˆ¶
2. ä½¿ç”¨åŠ å¯†å­˜å‚¨æ•æ„Ÿé…ç½®
3. å»ºç«‹æ•æ„Ÿä¿¡æ¯æ‰«ææµæ°´çº¿

## 7. æœ€ç»ˆæ£€æŸ¥ç»“æœæ€»ç»“

### 7.1 ç¡®è®¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶æ¸…å•

**æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰ï¼š**
1. `conf/default/mysql/.cnf` - MySQLå¯†ç ï¼š`cozeloop-mysql`
2. `conf/default/redis/.cnf` - Rediså¯†ç ï¼š`cozeloop-redis`
3. `conf/default/clickhouse/.cnf` - ClickHouseå¯†ç ï¼š`cozeloop-clickhouse`
4. `conf/default/minio/.cnf` - MinIOå¯†ç ï¼š`cozeloop-minio`

**æ¨¡å‹APIé…ç½®æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰ï¼š**
5. `conf/default/app/runtime/model_config.yaml` - è±†åŒ…å’ŒOpenAI APIå¯†é’¥ï¼ˆå·²è„±æ•ï¼‰
6. `conf/default/app/runtime/model_runtime_config.yaml` - åƒå¸†AccessKey/SecretKeyï¼ˆå·²è„±æ•ï¼‰

**åŸºç¡€è®¾æ–½é…ç½®æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰ï¼š**
7. `conf/default/app/runtime/infrastructure.yaml` - æ±‡æ€»æ‰€æœ‰æœåŠ¡å¯†ç 

**å¯åŠ¨è„šæœ¬æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰ï¼š**
8. `conf/default/mysql/entrypoint.sh` - å¤„ç†MySQLå¯†ç 
9. `conf/default/redis/entrypoint.sh` - å¤„ç†Rediså¯†ç 
10. `conf/default/minio/entrypoint.sh` - å¤„ç†MinIOå¯†ç å’Œç¯å¢ƒå˜é‡
11. `conf/default/clickhouse/entrypoint.sh` - å¤„ç†ClickHouseå¯†ç 

**ä»£ç æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰ï¼š**
12. `backend/cmd/main.go` - å®šä¹‰æ•æ„Ÿä¿¡æ¯é…ç½®ç»“æ„
13. `backend/modules/llm/domain/entity/config.go` - LLMé…ç½®ç»“æ„

**æ¨¡æ¿æ–‡ä»¶ï¼ˆ9ä¸ªï¼‰ï¼š**
14. `backend/modules/llm/infra/config/model_repo_example/openai.yaml`
15. `backend/modules/llm/infra/config/model_repo_example/claude.yaml`
16. `backend/modules/llm/infra/config/model_repo_example/qianfan.yaml`
17. `backend/modules/llm/infra/config/model_repo_example/ark.yaml`
18. `backend/modules/llm/infra/config/model_repo_example/arkbot.yaml`
19. `backend/modules/llm/infra/config/model_repo_example/deepseek.yaml`
20. `backend/modules/llm/infra/config/model_repo_example/gemini.yaml`
21. `backend/modules/llm/infra/config/model_repo_example/ollama.yaml`
22. `backend/modules/llm/infra/config/model_repo_example/qwen.yaml`

### 7.2 æ•æ„Ÿä¿¡æ¯é£é™©ç­‰çº§

**ğŸ”´ é«˜é£é™©ï¼ˆéœ€è¦ç«‹å³å¤„ç†ï¼‰ï¼š**
- æ•°æ®åº“æ˜æ–‡å¯†ç ï¼ˆ4ä¸ª.cnfæ–‡ä»¶ï¼‰
- å¯¹è±¡å­˜å‚¨æ˜æ–‡å¯†é’¥ï¼ˆMinIOé…ç½®ï¼‰
- æ¨¡å‹APIå¯†é’¥é…ç½®æ–‡ä»¶ï¼ˆè™½å·²è„±æ•ï¼Œä½†ç»“æ„æš´éœ²ï¼‰

**ğŸŸ¡ ä¸­é£é™©ï¼ˆå»ºè®®ä¼˜åŒ–ï¼‰ï¼š**
- é…ç½®æ–‡ä»¶è·¯å¾„ç¡¬ç¼–ç 
- å¯åŠ¨è„šæœ¬å¤„ç†æ•æ„Ÿä¿¡æ¯çš„æ–¹å¼
- æ¨¡å‹é…ç½®æ¨¡æ¿æ–‡ä»¶

**ğŸŸ¢ ä½é£é™©ï¼ˆæ³¨æ„ç›‘æ§ï¼‰ï¼š**
- ä»£ç ä¸­çš„é…ç½®ç»“æ„å®šä¹‰
- è¯„ä¼°é…ç½®æ–‡ä»¶ï¼ˆæ— æ•æ„Ÿä¿¡æ¯ï¼‰

### 7.3 æ ¸å¿ƒå‘ç°

âœ… **ç¡®è®¤å‘ç°æ¨¡å‹APIå¯†é’¥é…ç½®**ï¼šé¡¹ç›®ä¸­ç¡®å®åŒ…å«æ¨¡å‹APIå¯†é’¥çš„é…ç½®æ–‡ä»¶ï¼Œæ¶‰åŠï¼š
- è±†åŒ…(Ark)æ¨¡å‹API Key
- OpenAI API Key  
- åƒå¸†å¹³å°AccessKeyå’ŒSecretKey

âœ… **ç¡®è®¤å‘ç°æ•°æ®åº“æ•æ„Ÿä¿¡æ¯**ï¼šæ‰€æœ‰æ•°æ®åº“æœåŠ¡éƒ½æœ‰æ˜æ–‡å¯†ç é…ç½®

âœ… **ç¡®è®¤å‘ç°å¯¹è±¡å­˜å‚¨å¯†é’¥**ï¼šMinIOæœåŠ¡çš„è®¿é—®å¯†é’¥æ˜æ–‡å­˜å‚¨

**æ€»è®¡å‘ç°ï¼š22ä¸ªæ–‡ä»¶åŒ…å«æˆ–æ¶‰åŠæ•æ„Ÿä¿¡æ¯é…ç½®**